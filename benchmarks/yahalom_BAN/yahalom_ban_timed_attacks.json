{
  "meta": {
    "protocol": "Yahalom_BAN_Timed",
    "aka": [
      "BAN simplified Yahalom (timed)"
    ],
    "version": "4-step BAN simplified variant; timed checks optional",
    "alice_bob_input_checked": {
      "provided": [
        "1. A->B: A, Ta",
        "2. B->S: B, Tb, {A, Ta}Kbs",
        "3. S->A: Tb, {B, Kab, Ta}Kas, {A, Kab, Tb}Kbs",
        "4. A->B: {A, Kab, Tb}Kbs, {Tb}Kab"
      ],
      "status": "OK (structure consistent with BAN simplified Yahalom; normalize key names Kab/Kas/Kbs -> KAB/KAS/KBS).",
      "notes": [
        "Compared to Paulson's strengthened Yahalom, the ticket for B is {A,KAB,Tb}KBS (it does not include B inside the ticket).",
        "Timed option: attach lifetimes LF(Ta), LF(Tb). A checks Ta when accepting step 3 (inside {B,KAB,Ta}KAS). B checks Tb when accepting step 4 (inside both the ticket and {Tb}KAB)."
      ]
    },
    "messages": [
      "1. A->B: A, Ta",
      "2. B->S: B, Tb, {A, Ta}KBS",
      "3. S->A: Tb, {B, KAB, Ta}KAS, {A, KAB, Tb}KBS",
      "4. A->B: {A, KAB, Tb}KBS, {Tb}KAB"
    ],
    "notation": {
      "concat": "|",
      "encrypt": "<K, ...>",
      "examples": {
        "{A,Ta}KBS": "<KBS,A|Ta>",
        "{B,KAB,Ta}KAS": "<KAS,B|KAB|Ta>",
        "{A,KAB,Tb}KBS": "<KBS,A|KAB|Tb>",
        "{Tb}KAB": "<KAB,Tb>",
        "step3": "Tb|<KAS,B|KAB|Ta>|<KBS,A|KAB|Tb>",
        "step4": "<KBS,A|KAB|Tb>|<KAB,Tb>"
      }
    },
    "hints": [
      "Use --session-vars KAB when generating .protoc so KAB is instantiated per sid.",
      "Timed option: --ticket-lifetimes Ta:<LF>;Tb:<LF> (optional).",
      "Runs with tc_extra stale(Ta#k)/stale(Tb#k) require tc_extra support in the .protoc generator."
    ]
  },
  "runs": [
    {
      "name": "honest",
      "overrides": []
    },
    {
      "name": "replay_step4_sid1_to_sid2_requires_Tb_reuse",
      "overrides": [
        {
          "sid": 1,
          "step": 4,
          "kind": "replace",
          "edge": "A->I",
          "L": "<KBS,A|KAB#1|Tb#1>|<KAB#1,Tb#1>"
        },
        {
          "sid": 2,
          "step": 2,
          "kind": "replace",
          "edge": "B->S",
          "L": "B|Tb#1|<KBS,A|Ta#2>"
        },
        {
          "sid": 2,
          "step": 4,
          "kind": "intruder",
          "edge": "I->B",
          "L": "<KBS,A|KAB#1|Tb#1>|<KAB#1,Tb#1>"
        }
      ]
    },
    {
      "name": "replay_step4_stale_Tb_should_fail",
      "overrides": [
        {
          "sid": 1,
          "step": 4,
          "kind": "replace",
          "edge": "A->I",
          "L": "<KBS,A|KAB#1|Tb#1>|<KAB#1,Tb#1>"
        },
        {
          "sid": 2,
          "step": 2,
          "kind": "replace",
          "edge": "B->S",
          "L": "B|Tb#1|<KBS,A|Ta#2>"
        },
        {
          "sid": 2,
          "step": 4,
          "kind": "intruder",
          "edge": "I->B",
          "L": "<KBS,A|KAB#1|Tb#1>|<KAB#1,Tb#1>",
          "tc_extra": "stale(Tb#1)"
        }
      ]
    },
    {
      "name": "replay_step3_sid1_to_sid2_requires_Ta_reuse",
      "overrides": [
        {
          "sid": 1,
          "step": 3,
          "kind": "replace",
          "edge": "S->I",
          "L": "Tb#1|<KAS,B|KAB#1|Ta#1>|<KBS,A|KAB#1|Tb#1>"
        },
        {
          "sid": 2,
          "step": 1,
          "kind": "replace",
          "edge": "A->B",
          "L": "A|Ta#1"
        },
        {
          "sid": 2,
          "step": 3,
          "kind": "intruder",
          "edge": "I->A",
          "L": "Tb#1|<KAS,B|KAB#1|Ta#1>|<KBS,A|KAB#1|Tb#1>"
        },
        {
          "sid": 2,
          "step": 4,
          "kind": "replace",
          "edge": "A->B",
          "L": "<KBS,A|KAB#1|Tb#1>|<KAB#1,Tb#1>"
        }
      ]
    },
    {
      "name": "replay_step3_stale_Ta_should_fail",
      "overrides": [
        {
          "sid": 1,
          "step": 3,
          "kind": "replace",
          "edge": "S->I",
          "L": "Tb#1|<KAS,B|KAB#1|Ta#1>|<KBS,A|KAB#1|Tb#1>"
        },
        {
          "sid": 2,
          "step": 1,
          "kind": "replace",
          "edge": "A->B",
          "L": "A|Ta#1"
        },
        {
          "sid": 2,
          "step": 3,
          "kind": "intruder",
          "edge": "I->A",
          "L": "Tb#1|<KAS,B|KAB#1|Ta#1>|<KBS,A|KAB#1|Tb#1>",
          "tc_extra": "stale(Ta#1)"
        },
        {
          "sid": 2,
          "step": 4,
          "kind": "replace",
          "edge": "A->B",
          "L": "<KBS,A|KAB#1|Tb#1>|<KAB#1,Tb#1>"
        }
      ]
    },
    {
      "name": "inject_step4_only_ticket_should_fail",
      "overrides": [
        {
          "sid": 1,
          "step": 3,
          "kind": "replace",
          "edge": "S->I",
          "L": "Tb#1|<KAS,B|KAB#1|Ta#1>|<KBS,A|KAB#1|Tb#1>"
        },
        {
          "sid": 1,
          "step": 4,
          "kind": "intruder",
          "edge": "I->B",
          "L": "<KBS,A|KAB#1|Tb#1>"
        }
      ]
    },
    {
      "name": "inject_step4_only_response_should_fail",
      "overrides": [
        {
          "sid": 1,
          "step": 4,
          "kind": "intruder",
          "edge": "I->B",
          "L": "<KAB#1,Tb#1>"
        }
      ]
    },
    {
      "name": "mitm_capture_step4_A_to_B",
      "overrides": [
        {
          "sid": 1,
          "step": 4,
          "kind": "replace",
          "edge": "A->I",
          "L": "<KBS,A|KAB#1|Tb#1>|<KAB#1,Tb#1>"
        }
      ]
    },
    {
      "name": "inject_step4_wrong_A_inside_ticket_should_fail",
      "overrides": [
        {
          "sid": 1,
          "step": 4,
          "kind": "intruder",
          "edge": "I->B",
          "L": "<KBS,I|KAB#1|Tb#1>|<KAB#1,Tb#1>"
        }
      ]
    },
    {
      "name": "compromise_KAS_forge_step3_to_A_with_attacker_KAB",
      "overrides": [
        {
          "sid": 1,
          "step": 3,
          "kind": "intruder",
          "edge": "I->A",
          "L": "Tb#1|<KAS,B|KABi#1|Ta#1>|<KBS,A|KABi#1|Tb#1>"
        }
      ]
    },
    {
      "name": "compromise_KBS_forge_ticket_to_B_in_step4",
      "overrides": [
        {
          "sid": 1,
          "step": 4,
          "kind": "intruder",
          "edge": "I->B",
          "L": "<KBS,A|KABi#1|Tb#1>|<KABi#1,Tb#1>"
        }
      ]
    },
    {
      "name": "key_compromise_KAB_forge_response_in_step4",
      "overrides": [
        {
          "sid": 1,
          "step": 4,
          "kind": "intruder",
          "edge": "I->B",
          "L": "<KBS,A|KAB#1|Tb#1>|<KAB#1,Tb#1>"
        }
      ]
    },
    {
      "name": "typeflaw_Ta_is_A_in_step1",
      "overrides": [
        {
          "sid": 1,
          "step": 1,
          "kind": "replace",
          "edge": "A->B",
          "L": "A|A"
        }
      ]
    },
    {
      "name": "typeflaw_Tb_is_B_in_step2",
      "overrides": [
        {
          "sid": 1,
          "step": 2,
          "kind": "replace",
          "edge": "B->S",
          "L": "B|B|<KBS,A|Ta#1>"
        }
      ]
    },
    {
      "name": "all_intruder_steps_sid1",
      "overrides": [
        {
          "sid": 1,
          "step": 1,
          "kind": "intruder",
          "edge": "I->B",
          "L": "A|Ta#1"
        },
        {
          "sid": 1,
          "step": 2,
          "kind": "intruder",
          "edge": "I->S",
          "L": "B|Tb#1|<KBS,A|Ta#1>"
        },
        {
          "sid": 1,
          "step": 3,
          "kind": "intruder",
          "edge": "I->A",
          "L": "Tb#1|<KAS,B|KAB#1|Ta#1>|<KBS,A|KAB#1|Tb#1>"
        },
        {
          "sid": 1,
          "step": 4,
          "kind": "intruder",
          "edge": "I->B",
          "L": "<KBS,A|KAB#1|Tb#1>|<KAB#1,Tb#1>"
        }
      ]
    }
  ]
}